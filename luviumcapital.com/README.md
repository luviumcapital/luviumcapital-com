# Luvium Capital Website

A modern, full-stack web application for Luvium Capital built with React, TypeScript, and tRPC.

## ğŸš€ Quick Start

### Local Development

1. **Clone the repository**
   ```bash
   git clone <your-repo-url>
   cd luviumcapital-com
   ```

2. **Install dependencies**
   ```bash
   pnpm install
   ```

3. **Start development environment**
   ```bash
   # Using Docker Compose (recommended)
   docker compose -f docker/compose.yaml up

   # Or using the script
   ./scripts/docker-compose up
   ```

4. **Access the application**
   - Website: http://localhost:8000
   - Database Admin: http://localhost:8000/codapt/db/
   - MinIO Console: http://localhost:9001

### Environment Variables

Copy the `.env` file and update values as needed:
```env
NODE_ENV=development
BASE_URL=http://localhost:8000
ADMIN_PASSWORD=your-password
JWT_SECRET=your-secret
```

## ğŸ“¦ Tech Stack

- **Frontend**: React, TypeScript, TanStack Router, Tailwind CSS
- **Backend**: Node.js, tRPC, Prisma ORM
- **Database**: PostgreSQL
- **Cache**: Redis
- **Storage**: MinIO (S3-compatible)
- **Deployment**: Railway with Docker
- **SSL**: Automatic via Railway (Let's Encrypt)

## ğŸŒ Production Deployment

This application is configured for deployment on Railway with a custom domain and automatic SSL.

**ğŸ“– See [DEPLOYMENT.md](./DEPLOYMENT.md) for complete deployment instructions.**

### Key Features of Production Setup

âœ… **Automatic HTTPS**: Railway provides SSL termination with Let's Encrypt  
âœ… **Custom Domain**: Configured for www.luviumcapital.com  
âœ… **Managed Database**: Railway PostgreSQL with automatic backups  
âœ… **Optimized Build**: Multi-stage Docker build for production  
âœ… **Security**: Environment-based secrets, CORS protection  

## ğŸ”§ Development

### Project Structure

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/       # React components
â”‚   â”œâ”€â”€ routes/          # TanStack Router pages
â”‚   â”œâ”€â”€ server/          # Backend code (tRPC, database)
â”‚   â”œâ”€â”€ stores/          # Zustand state management
â”‚   â””â”€â”€ trpc/            # tRPC client setup
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile       # Local development
â”‚   â””â”€â”€ nginx/           # Nginx configuration
â”œâ”€â”€ railway.Dockerfile   # Production build for Railway
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma    # Database schema
â””â”€â”€ public/              # Static assets
```

### Available Scripts

```bash
# Development (with hot reload)
pnpm dev

# Build for production
pnpm build

# Start production server
pnpm start

# Run database migrations
pnpm prisma migrate dev

# Open Prisma Studio
pnpm prisma studio

# Code formatting
pnpm format

# Type checking
pnpm typecheck
```

### Docker Compose Services

- **nginx**: Reverse proxy (port 8000)
- **app**: Main application (port 3000)
- **postgres**: Database (port 5432)
- **redis**: Cache (port 6379)
- **minio**: Object storage (ports 9000, 9001)
- **adminer**: Database admin UI

## ğŸ”’ Security

### Environment Variables

**Never commit sensitive values to Git!**

Required environment variables:
- `NODE_ENV`: Set to `production` for deployment
- `BASE_URL`: Full URL with https:// for production
- `ADMIN_PASSWORD`: Strong, unique password
- `JWT_SECRET`: Cryptographically secure random string
- `DATABASE_URL`: Auto-generated by Railway

### Generating Secure Secrets

```bash
# Generate JWT secret
openssl rand -base64 32

# Generate admin password
openssl rand -base64 24
```

## ğŸ› Troubleshooting

### SSL Certificate Issues

If you see SSL certificate errors:

1. **Check BASE_URL**: Must use `https://` in production
2. **Verify DNS**: Ensure CNAME record points to Railway
3. **Wait for propagation**: DNS changes take 1-2 hours
4. **Check Railway**: Verify SSL certificate is provisioned

See [DEPLOYMENT.md](./DEPLOYMENT.md) for detailed troubleshooting.

### Database Connection Issues

```bash
# Check database connection
docker compose -f docker/compose.yaml exec postgres psql -U postgres -d app

# Run migrations
pnpm prisma migrate deploy

# Reset database (development only!)
pnpm prisma migrate reset
```

### Port Conflicts

If ports are already in use:
```bash
# Stop all containers
docker compose -f docker/compose.yaml down

# Check what's using the port
lsof -i :8000
```

## ğŸ“ Development Workflow

1. **Create a feature branch**
   ```bash
   git checkout -b feature/your-feature
   ```

2. **Make changes and test locally**
   ```bash
   docker compose -f docker/compose.yaml up
   ```

3. **Commit and push**
   ```bash
   git add .
   git commit -m "Add your feature"
   git push origin feature/your-feature
   ```

4. **Create pull request**
   - Railway will automatically deploy preview environments
   - Review and merge to main
   - Main branch auto-deploys to production

## ğŸš¢ Deployment Process

### Automatic Deployment

1. Push to `main` branch
2. Railway detects changes
3. Builds using `railway.Dockerfile`
4. Runs database migrations (if configured)
5. Deploys to production
6. Health check verifies deployment

### Manual Deployment

```bash
# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# Link to project
railway link

# Deploy
railway up
```

## ğŸ“Š Monitoring

### Railway Dashboard
- View logs in real-time
- Monitor CPU, memory, network usage
- Check deployment history
- Manage environment variables

### Application Logs
```bash
# View logs locally
docker compose -f docker/compose.yaml logs -f app

# View Railway logs
railway logs
```

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## ğŸ“„ License

[Your License Here]

## ğŸ†˜ Support

- **Documentation**: See [DEPLOYMENT.md](./DEPLOYMENT.md)
- **Issues**: Create a GitHub issue
- **Railway Support**: https://railway.app/help

## ğŸ¯ Recent Changes

### SSL Configuration Fix (Latest)

Fixed SSL certificate issues for production deployment:

- âœ… Updated `.env` with production BASE_URL (`https://`)
- âœ… Created `railway.Dockerfile` for optimized production builds
- âœ… Updated Nginx configuration to accept Railway's SSL-terminated traffic
- âœ… Added comprehensive deployment guide
- âœ… Configured Railway-specific settings in `railway.json`

**Result**: Application now works correctly with Railway's SSL termination and custom domains from IONOS.

## ğŸ“š Additional Documentation

- [Deployment Guide](./DEPLOYMENT.md) - Complete guide for Railway deployment
- [TanStack Router Docs](https://tanstack.com/router/latest)
- [tRPC Documentation](https://trpc.io/docs)
- [Prisma Documentation](https://www.prisma.io/docs)
- [Railway Documentation](https://docs.railway.app/)

---

**Built with â¤ï¸ for Luvium Capital**
